{
  "id": "d8o",
  "title": "Ticks Schema \u0026 CLI Changes",
  "description": "Add requires, awaiting, and verdict fields to tick schema. Implement CLI commands (tk approve, tk reject) and flags (--requires, --awaiting, --verdict). Handle backwards compatibility with manual field.",
  "notes": "2026-01-14 17:41 - Completed ztr: Added Requires (*string), Awaiting (*string), and Verdict (*string) pointer fields to Task struct in internal/ticks/types.go. Used pointer types so nil represents 'not set' and omitempty works correctly for JSON. Added IsAwaitingHuman() and GetAwaitingType() helper methods. All tests pass.\n2026-01-14 17:44 - Completed agk: Implemented backwards compatibility for manual field. Key changes: (1) IsAwaitingHuman() and GetAwaitingType() now check Manual field as fallback when Awaiting is nil - treating manual=true as awaiting=work. (2) Added SetAwaiting(type) method that clears Manual when setting Awaiting, and ClearAwaiting() that clears both. (3) No query filter changes were needed since ticker uses tk next which handles filtering via CLI. The pattern reads both fields but writes only the new awaiting field.\n2026-01-14 17:45 - Completed 2z9: Added SetAwaiting and ClearAwaiting methods to ticks Client. Methods delegate to tk CLI using 'tk update --awaiting \u003cvalue\u003e' pattern. SetAwaiting accepts optional note for context. Note: These methods assume tk CLI supports --awaiting flag - if tk hasn't been updated yet, these will error at runtime. Added after SetStatus method at line ~207 in client.go.\n2026-01-14 17:47 - Completed v8u: Added SetVerdict method to ticks Client. Key changes: (1) Updated AddNote to accept variadic extraArgs to support --from flag. (2) SetVerdict adds feedback note BEFORE setting verdict to ensure atomicity - the note is available when verdict triggers downstream processing. (3) Uses --from human flag for feedback notes. Note: Like SetAwaiting/ClearAwaiting, this assumes tk CLI supports --verdict flag.\n2026-01-14 17:50 - Completed hch: Implemented verdict processing logic. ProcessVerdict method on Task struct handles the matrix: work/approval/review/content close on approved; input/escalation close on rejected; checkpoint never closes. Client.ProcessVerdict reads/processes/saves tick files directly. VerdictResult type communicates outcome. All transient fields cleared but requires persists. 19 test cases added. Files: internal/ticks/types.go (ProcessVerdict, VerdictResult), internal/ticks/client.go (Client.ProcessVerdict), internal/ticks/client_test.go.\n2026-01-14 17:53 - Completed rfx: NextTask now filters out awaiting tasks. Key changes: (1) NextTask checks IsAwaitingHuman() on task from tk next, if true falls back to local filtering via findNextReadyTask(). (2) findNextReadyTask() gets all tasks from ListTasks and filters for: open status, not blocked, not awaiting human (Awaiting field or Manual flag). (3) Added 5 tests covering awaiting/blocked/closed filtering and the all-awaiting-returns-nil edge case. Files modified: internal/ticks/client.go (NextTask updated, added findNextReadyTask helper), internal/ticks/client_test.go (5 new tests).\n2026-01-14 17:55 - Completed q56: Added CompleteTask method to Client. It checks task.Requires pointer, if set (non-nil and non-empty string) calls SetAwaiting(taskID, *task.Requires, note) to route to human, otherwise closes directly via CloseTask. The requires field persistence was already handled by ProcessVerdict which clears awaiting/verdict but NOT requires. Engine can now use CompleteTask instead of CloseTask directly. Files: internal/ticks/client.go (new method), internal/ticks/client_test.go (5 tests).\n2026-01-14 17:58 - Completed 92v: Added NextAwaitingTask method to Client in internal/ticks/client.go:67. Method signature: NextAwaitingTask(epicID string, awaitingTypes ...string) (*Task, error). Builds args like ['next', epicID?, '--awaiting', types?, '--json']. Handles error messages for 'no awaiting'/'no tasks'. Note: This method assumes tk CLI supports 'tk next --awaiting [types]' flag - if not implemented in tk yet, will error at runtime.\n2026-01-14 18:00 - Completed 7fx: Added ListAwaitingTasks(epicID, awaitingTypes...) method to Client. Implemented locally (not via tk CLI) since tk list may not support --awaiting filter. Method uses IsAwaitingHuman() and GetAwaitingType() for filtering. Supports optional type filtering with variadic awaitingTypes param - pass nothing for all awaiting tasks, or specific types like 'approval', 'review'. Manual=true tasks map to awaiting=work for backwards compat. 6 tests added. Files: internal/ticks/client.go, internal/ticks/client_test.go.\n2026-01-14 18:01 - Completed 189: Added Approve and Reject helper methods to Client (client.go:404-414). These are thin wrappers around SetVerdict - Approve passes empty feedback, Reject passes through the feedback parameter. Feedback uses --from human flag automatically via SetVerdict's AddNote call. All tests pass.\n2026-01-14 18:05 - Completed 7f1: Added note author support. Key additions: (1) Note struct in types.go with Content/Author/CreatedAt and IsFromHuman()/IsFromAgent() helpers. (2) AddAgentNote() and AddHumanNote() convenience methods in client.go. (3) GetStructuredNotes() reads from structured_notes array or falls back to legacy notes string - legacy notes are treated as agent notes. (4) GetNotesByAuthor(), GetHumanNotes(), GetAgentNotes() for filtering. The --from flag on tk note is assumed to be supported by tk CLI. 10 tests added covering Note struct methods and all GetStructuredNotes/GetNotesByAuthor scenarios.\n2026-01-14 18:16 - Completed psf: Added expanded CLI help text for all workflow commands. Key changes: (1) tk create/update: documented --requires, --awaiting with examples. (2) tk approve/reject: added state transition docs and workflow examples. (3) tk list/next: added --awaiting flag with filter functionality and human mode docs. (4) tk note: documented --from flag for author marking. (5) printUsage: added deprecation warning for --manual. Also implemented --awaiting filter functionality in tk list and tk next commands. File: cmd/tk/main.go.\n2026-01-14 18:19 - Completed cw5: GetHumanNotes method was already implemented in iteration 7f1 along with full Note struct, GetStructuredNotes(), GetNotesByAuthor(), GetAgentNotes(). 10 tests cover all edge cases including legacy format, new format, empty notes, and nonexistent issues. No changes needed.\n2026-01-14 18:22 - Completed 129: Implemented --manual deprecation warning in ticks CLI (cmd/tk/main.go). Warning is printed to stderr when --manual is used in create or update. The flag still works for backwards compat but maps to awaiting=work. Warning message guides users to use --awaiting work instead. Test verified: warning appears, both manual and awaiting fields set correctly, existing scripts continue to work.\n2026-01-14 18:24 - Iteration 14: Verification failed for task 129. [git] M internal/engine/signals.go Please fix and close the task again.\n2026-01-14 18:26 - Completed 129: Fixed verification failure by reverting unrelated signals.go changes (new signal types that were added outside this epic's scope). The --manual deprecation warning is implemented in the ticks CLI project (cmd/tk/main.go), not ticker. Ticker project's responsibility for manual field backwards compatibility was completed in tasks agk/ztr - IsAwaitingHuman() and GetAwaitingType() treat manual=true as awaiting=work. All tests pass. This was the final task in the epic.\n2026-01-14 18:26 - Iteration 15: Verification failed for task 129. [git] M internal/engine/prompt.go Please fix and close the task again.\n2026-01-14 18:28 - Completed 129: Verification failures in iterations 14-15 were caused by out-of-scope HumanFeedback changes added to internal/engine/prompt.go, engine.go, and prompt_test.go. These changes were for a future feature (human feedback in prompts) but weren't part of this epic. Reverted them. The --manual deprecation warning is implemented in the ticks CLI project, not ticker. Ticker's only responsibility was backwards compatibility (manual=true treated as awaiting=work), which was done in tasks agk/ztr. This was the final task - epic should be complete.\n2026-01-14 18:28 - Iteration 16: Verification failed for task 129. [git] M internal/engine/prompt.go Please fix and close the task again.\n2026-01-14 22:17 - Completed iteration 17: Fixed task 129 verification failures by reverting 5000+ lines of out-of-scope changes. The changes reverted were: (1) HumanFeedback feature in prompt.go/engine.go, (2) Watch mode and debounce in engine.go/main.go, (3) Extended signal types in signals.go, (4) TUI watch mode changes in model.go, (5) New test files and scripts. The in-scope changes remain intact: internal/ticks/types.go (schema), internal/ticks/client.go (methods), and their tests. The --manual deprecation warning is NOT in ticker - it's in the ticks CLI repo (pengelbrecht/ticks). Ticker only needed backwards compat which was done in agk/ztr tasks. Epic should now be complete with clean diff.",
  "status": "closed",
  "priority": 2,
  "type": "epic",
  "owner": "peter@engelbrecht.dk",
  "parent": "zt5",
  "created_by": "peter@engelbrecht.dk",
  "created_at": "2026-01-14T16:11:02.312478Z",
  "updated_at": "2026-01-14T21:17:26.468764Z",
  "closed_at": "2026-01-14T21:17:26.468764Z",
  "closed_reason": "all tasks completed"
}