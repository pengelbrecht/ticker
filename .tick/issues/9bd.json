{
  "id": "9bd",
  "title": "Test Harness \u0026 Integration Tests",
  "description": "Build comprehensive test suite for agent-human workflow. Test all signal types, verdict processing, handoff flows, and worktree integration. Ensure edge cases are covered.",
  "notes": "2026-01-14 19:01 - Completed [crp]: Updated mockTicksClient with full awaiting/verdict workflow support. Key additions: (1) State maps for tracking awaiting, verdict, and structured notes; (2) SetAwaiting/SetVerdict methods with call tracking for assertions; (3) GetHumanNotes filters by author; (4) SimulateVerdictProcessing helper mirrors Task.ProcessVerdict logic from types.go; (5) Tests verify all verdict processing scenarios (approval, review, content, work, input, escalation, checkpoint). Mock now ready for integration tests.\n2026-01-14 19:02 - Completed [hwx]: Added comprehensive signal parsing tests. Key additions: (1) TestParseSignals_AllTypes - matches task spec exactly, covers all 9 signals with context; (2) TestParseSignals_SignalPriority - tests full priority chain; (3) TestParseSignals_EdgeCases - tests malformed tags, unicode, whitespace trimming, empty contexts, nested tags; (4) Extended existing TestParseSignals with 16 more edge cases. Total 87 test cases all passing. File: internal/engine/signals_test.go\n2026-01-14 19:07 - Completed [x34]: Added comprehensive handleSignal tests. Key changes: (1) Introduced TicksClient interface in engine.go to enable dependency injection for testing - Engine now accepts TicksClient interface instead of *ticks.Client; (2) 5 new test functions covering all signal→awaiting mappings, requires field logic, context passing, and unknown signal handling; (3) Updated mockTicksClient with closedTasks map (map[string]bool) for easier assertions. This refactoring pattern can be reused for other engine methods that need testing.\n2026-01-14 19:10 - Completed [8fm]: Added verdict_test.go in internal/engine with comprehensive unit tests (82+ cases). Key coverage: (1) TestVerdictProcessing covers all 14 awaiting×verdict combinations with wantBackTo field; (2) TestVerdictProcessing_RequiresNotCleared exhaustively tests requires persistence across ALL 42 awaiting/verdict combos (3 requires × 7 awaiting × 2 verdicts); (3) TestVerdictProcessing_TransientFieldsCleared verifies Awaiting/Verdict/Manual are cleared for all scenarios including unknown types; (4) TestVerdictProcessing_RejectionCycle tests full rejection→resubmit→approval workflow. Note: ticks package already had TestTaskProcessVerdict in client_test.go - the new tests complement those with additional edge cases and the exact format specified in the task.\n2026-01-14 19:14 - Completed [bm1]: Added comprehensive integration tests for full handoff flows in internal/engine/handoff_test.go. Key additions: (1) handoffMockAgent with multi-response queueing and prompt tracking; (2) handoffMockTicksClient with full workflow simulation including SimulateHumanApproval/Rejection and processVerdict; (3) 12 test functions covering all acceptance criteria - approval flow, rejection/retry loop, feedback passing, multiple handoffs, requires field, and all signal types. Tests verify the complete agent→human→agent cycle including prompt content verification to ensure feedback is passed through.\n2026-01-14 19:16 - Completed [voc]: Added backwards_compat_test.go with 15 test functions covering all acceptance criteria. Key tests: (1) TestBackwardsCompat_ManualField verifies manual=true→awaiting=work; (2) TestBackwardsCompat_NextExcludesManual/AwaitingAndManual verify NextTask filtering; (3) TestBackwardsCompat_NewAwaitingTakesPrecedence confirms Awaiting field takes precedence; (4) TestBackwardsCompat_MigrationNotRequired tests 7 JSON format variations proving no migration needed. Also covered: SetAwaiting/ClearAwaiting clearing Manual, ProcessVerdict clearing Manual, verdict processing on upgraded manual tasks. All 15 tests pass.\n2026-01-14 19:20 - Completed [k6b]: Added worktree_handoff_test.go with comprehensive integration tests using real git worktrees. Key infrastructure: (1) worktreeMockAgent tracks WorkDir in each call; (2) createTempGitRepo helper creates temp repos with initial commit; (3) Tests use handoffMockTicksClient from handoff_test.go. Test coverage: PreservedOnHandoff, SameWorktreeAfterRejection, ChangesNotLost, CleanupOnEpicComplete (uses OnIterationEnd hook to simulate tk close), NotCleanedUpOnBudgetLimit, ParallelEpicsIsolated, ExistingWorktreeReused (with filepath.EvalSymlinks for macOS /var symlink), CommittedChangesOnBranch, CleanupOnNoTasksFound, WorkDirPassedToAgent. All 11 tests pass. File: internal/engine/worktree_handoff_test.go\n2026-01-14 19:23 - Completed [ms4]: Created scripts/test-handoff-workflow.sh for manual workflow verification. Script creates 7 test tasks covering all workflow types (normal, requires approval/review/content, awaiting work, blocked). Includes comprehensive instructions for all test scenarios: approval flow, rejection/retry loop, human work flow, eject flow. Script tested successfully - cleans up old runs, creates tasks with correct fields.",
  "status": "closed",
  "priority": 2,
  "type": "epic",
  "owner": "peter@engelbrecht.dk",
  "parent": "zt5",
  "created_by": "peter@engelbrecht.dk",
  "created_at": "2026-01-14T16:11:03.896977Z",
  "updated_at": "2026-01-14T18:23:47.065072Z",
  "closed_at": "2026-01-14T18:23:47.065072Z",
  "closed_reason": "all tasks completed"
}