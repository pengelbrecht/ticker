{
  "id": "uzr",
  "title": "Epic Context: Pre-computed context documents per epic",
  "description": "Reduce redundant context-gathering across tasks by generating a shared context document per epic. Each task currently spends ~5k tokens gathering similar context. This feature generates context once when an epic starts and injects it into every task's prompt.\n\n## Goals\n- Reduce token usage by 50%+ for multi-task epics\n- Improve task execution speed by eliminating redundant exploration\n- Maintain agent-agnostic design (works with Claude, Codex, Gemini)\n\n## Success Metrics\n- Context generation completes in \u003c2 minutes\n- Context docs stay under 4000 tokens\n- Tasks with injected context complete faster than without\n\n## References\n- docs/EPIC_CONTEXT.md - Full specification",
  "notes": "2026-01-17 12:39 - vts completed: Created internal/context package with Store struct. API follows checkpoint package patterns. Key design decisions: (1) Load returns empty string not error when file missing - callers should use Exists() first if they need to distinguish between empty context and no context. (2) Uses atomic writes (temp file + rename) for safety. (3) Directory path configurable via NewStoreWithDir for testing. Ready for next tasks to integrate with engine.\n2026-01-17 12:42 - i7w completed: Added comprehensive unit tests for context storage. Coverage now at 100%. Tests cover: (1) special characters in epic IDs using table-driven tests, (2) concurrent read/write safety with atomic counters and goroutines - tests pass with -race flag, (3) error paths for directory creation, write, read, and delete failures. Note: concurrent writes to the SAME file can fail due to temp file conflicts in the atomic write approach - this is documented behavior for the simple file store.\n2026-01-17 12:44 - 811 completed: Created context.PromptBuilder in internal/context/prompt.go. Key design: (1) NewPromptBuilder returns error for template parsing failure (future-proofing for custom templates), (2) Build takes *ticks.Epic and []ticks.Task to match how engine will call it, (3) Template includes all 5 sections from EPIC_CONTEXT.md spec with 4000 token constraint. Tests cover edge cases: empty tasks, empty descriptions, special chars (markdown, unicode, newlines), many tasks.\n2026-01-17 12:46 - 2026-01-17 12:46 - 4oj completed: Created context.Generator in internal/context/generator.go. Key design: (1) Uses functional options pattern (WithTimeout, WithLogger) for configuration, (2) NewGenerator takes agent.Agent interface making it testable with mocks, (3) Generate method builds prompt via PromptBuilder and passes to agent with configured timeout, (4) Logs structured events at start (epic_id, task_count) and completion (duration, tokens, cost). Tests use mockAgent implementing agent.Agent interface.\n2026-01-17 12:48 - nrt completed: Verified generator_test.go has comprehensive unit tests (10 tests, 94.4% coverage). Tests cover: success path, agent errors, nil epic, empty tasks, timeout configuration, context cancellation, logging, special characters. Mock agent is defined locally in test file. Note: 'Large output truncation' test case from spec is N/A - Generator returns output as-is; the 4000 token constraint is enforced by prompt instructions to the AI, not code-level truncation.\n2026-01-17 12:49 - 1gu completed: Added EpicContext string field to IterationContext in internal/engine/prompt.go. Field has godoc comment explaining it holds .ticker/context/\u003cepic-id\u003e.md contents or empty string. Next tasks need to: (1) integrate with prompt template to inject context, (2) load context from Store in engine before building prompt.\n2026-01-17 12:51 - 2026-01-17 12:51 - 5k7 completed: Added Epic Context section to prompt template in internal/engine/prompt.go. Implementation: (1) Added EpicContext to templateData struct, (2) Wired EpicContext from IterationContext in Build method, (3) Added conditional template section with header and intro text that appears before Epic Notes. Tests verify: section appears when context provided, hidden when empty, and positioned before Epic Notes. Next task needs to load context from Store in engine and populate EpicContext field.\n2026-01-17 12:55 - 1q7 completed: Integrated context generation into engine. Key design: (1) SetContextComponents(store, generator) configures engine - both are optional, (2) ensureEpicContext runs once at start of Run(), generates context if epic has \u003e1 tasks and context doesn't exist, (3) loadEpicContext loads into runState.epicContext which is wired to IterationContext.EpicContext, (4) All errors are logged via runlog but don't abort run - context is purely optional. Added ListTasks to TicksClient interface. Next task needs to ensure cmd/ticker creates and injects context components.",
  "status": "open",
  "priority": 2,
  "type": "epic",
  "owner": "peter@engelbrecht.dk",
  "created_by": "peter@engelbrecht.dk",
  "created_at": "2026-01-17T11:23:04.962579Z",
  "updated_at": "2026-01-17T11:55:53.299044Z"
}