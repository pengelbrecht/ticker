{
  "id": "uzr",
  "title": "Epic Context: Pre-computed context documents per epic",
  "description": "Reduce redundant context-gathering across tasks by generating a shared context document per epic. Each task currently spends ~5k tokens gathering similar context. This feature generates context once when an epic starts and injects it into every task's prompt.\n\n## Goals\n- Reduce token usage by 50%+ for multi-task epics\n- Improve task execution speed by eliminating redundant exploration\n- Maintain agent-agnostic design (works with Claude, Codex, Gemini)\n\n## Success Metrics\n- Context generation completes in \u003c2 minutes\n- Context docs stay under 4000 tokens\n- Tasks with injected context complete faster than without\n\n## References\n- docs/EPIC_CONTEXT.md - Full specification",
  "notes": "2026-01-17 12:39 - vts completed: Created internal/context package with Store struct. API follows checkpoint package patterns. Key design decisions: (1) Load returns empty string not error when file missing - callers should use Exists() first if they need to distinguish between empty context and no context. (2) Uses atomic writes (temp file + rename) for safety. (3) Directory path configurable via NewStoreWithDir for testing. Ready for next tasks to integrate with engine.\n2026-01-17 12:42 - i7w completed: Added comprehensive unit tests for context storage. Coverage now at 100%. Tests cover: (1) special characters in epic IDs using table-driven tests, (2) concurrent read/write safety with atomic counters and goroutines - tests pass with -race flag, (3) error paths for directory creation, write, read, and delete failures. Note: concurrent writes to the SAME file can fail due to temp file conflicts in the atomic write approach - this is documented behavior for the simple file store.\n2026-01-17 12:44 - 811 completed: Created context.PromptBuilder in internal/context/prompt.go. Key design: (1) NewPromptBuilder returns error for template parsing failure (future-proofing for custom templates), (2) Build takes *ticks.Epic and []ticks.Task to match how engine will call it, (3) Template includes all 5 sections from EPIC_CONTEXT.md spec with 4000 token constraint. Tests cover edge cases: empty tasks, empty descriptions, special chars (markdown, unicode, newlines), many tasks.\n2026-01-17 12:46 - 2026-01-17 12:46 - 4oj completed: Created context.Generator in internal/context/generator.go. Key design: (1) Uses functional options pattern (WithTimeout, WithLogger) for configuration, (2) NewGenerator takes agent.Agent interface making it testable with mocks, (3) Generate method builds prompt via PromptBuilder and passes to agent with configured timeout, (4) Logs structured events at start (epic_id, task_count) and completion (duration, tokens, cost). Tests use mockAgent implementing agent.Agent interface.\n2026-01-17 12:48 - nrt completed: Verified generator_test.go has comprehensive unit tests (10 tests, 94.4% coverage). Tests cover: success path, agent errors, nil epic, empty tasks, timeout configuration, context cancellation, logging, special characters. Mock agent is defined locally in test file. Note: 'Large output truncation' test case from spec is N/A - Generator returns output as-is; the 4000 token constraint is enforced by prompt instructions to the AI, not code-level truncation.\n2026-01-17 12:49 - 1gu completed: Added EpicContext string field to IterationContext in internal/engine/prompt.go. Field has godoc comment explaining it holds .ticker/context/\u003cepic-id\u003e.md contents or empty string. Next tasks need to: (1) integrate with prompt template to inject context, (2) load context from Store in engine before building prompt.\n2026-01-17 12:51 - 2026-01-17 12:51 - 5k7 completed: Added Epic Context section to prompt template in internal/engine/prompt.go. Implementation: (1) Added EpicContext to templateData struct, (2) Wired EpicContext from IterationContext in Build method, (3) Added conditional template section with header and intro text that appears before Epic Notes. Tests verify: section appears when context provided, hidden when empty, and positioned before Epic Notes. Next task needs to load context from Store in engine and populate EpicContext field.\n2026-01-17 12:55 - 1q7 completed: Integrated context generation into engine. Key design: (1) SetContextComponents(store, generator) configures engine - both are optional, (2) ensureEpicContext runs once at start of Run(), generates context if epic has \u003e1 tasks and context doesn't exist, (3) loadEpicContext loads into runState.epicContext which is wired to IterationContext.EpicContext, (4) All errors are logged via runlog but don't abort run - context is purely optional. Added ListTasks to TicksClient interface. Next task needs to ensure cmd/ticker creates and injects context components.\n2026-01-17 12:58 - jra completed: Added integration tests for engine context generation in internal/engine/context_integration_test.go. Tests cover all 5 scenarios from spec: (1) 3+ task epic generates context before first task, (2) single-task epic skips generation, (3) existing context not regenerated, (4) failed generation proceeds without context, (5) context properly injected into prompt. Also added tests for context omission when empty and engine working without context components. All tests use mock agents and temp directories.\n2026-01-17 13:02 - y3e completed: Added 'ticker context' CLI command to cmd/ticker/main.go. Features: (1) Default behavior shows context if exists, generates if missing, (2) --show flag requires existing context, (3) --refresh forces regeneration, (4) --delete removes context file, (5) Validates epic-id exists, (6) Mutual exclusivity of flags, (7) Progress output during generation with task count and estimated token count. Skips generation for epics with ≤1 tasks. Uses context.Store for storage and context.Generator with ClaudeAgent for generation.\n2026-01-17 13:07 - vpy completed: Added ContextConfig to internal/verify/config.go with fields: enabled (bool*, default true), max_tokens (int*, default 4000), auto_refresh_days (int*, default 0), generation_timeout (string* parsed as duration, default 5m), generation_model (string*, default empty). Design: (1) Pointer fields for JSON omitempty + nil-check defaults, (2) Getter methods return defaults when nil, (3) Validate() enforces ranges (max_tokens 100-100000, auto_refresh_days 0-365, timeout 1s-1h), (4) Updated Generator and PromptBuilder to accept WithMaxTokens option. Config is validated at load time. Next tasks should wire config from cmd/ticker to engine - use LoadContextConfig() then pass values to context.NewGenerator(). Note: generation_model not yet wired to agent selection - that would require agent factory pattern.\n2026-01-17 13:09 - t2t completed: Added Epic Context documentation to CLAUDE.md. Includes: CLI command reference (ticker context with --show/--refresh/--delete), config options table with defaults/ranges, example workflow, troubleshooting section. Also updated Project Structure to show internal/context package and .ticker/ directory hierarchy. All acceptance criteria met.\n2026-01-17 13:15 - tu2 completed: Added TUI context status indicator. Implementation: (1) Added ContextStatus type with 4 states (none/generating/ready/failed) to model.go, (2) Added Context*Msg message types for single-epic and EpicContext*Msg for multi-epic mode, (3) Engine now has OnContext* callbacks that are invoked in ensureEpicContext and loadEpicContext, (4) renderStatusBar() shows context icon after epic title using new renderContextStatus() method, (5) Update handlers in model.go add log entries to output pane, (6) cmd/ticker wires callbacks to send TUI messages. Header format: [✓ Context] or [○ No ctx]. Log format: [Context] message. All tests pass including 8 new context-specific tests.",
  "status": "closed",
  "priority": 2,
  "type": "epic",
  "owner": "peter@engelbrecht.dk",
  "created_by": "peter@engelbrecht.dk",
  "created_at": "2026-01-17T11:23:04.962579Z",
  "updated_at": "2026-01-17T14:23:54.098865Z",
  "closed_at": "2026-01-17T14:23:54.098865Z"
}