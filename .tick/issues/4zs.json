{
  "blocked_by": [
    "ux4"
  ],
  "closed_at": "2026-01-14T17:43:06.304088Z",
  "closed_reason": "Added comprehensive handoff signals documentation to prompt.go. New '## Handoff Signals' section with table documenting all 8 signal types (COMPLETE, APPROVAL_NEEDED, INPUT_NEEDED, REVIEW_REQUESTED, CONTENT_REVIEW, ESCALATE, CHECKPOINT, EJECT) with usage guidance. Added '## Reading Human Feedback' section. Removed old 'Exit signals' rule in favor of full documentation. Updated tests to verify all signals are documented.",
  "created_at": "2026-01-14T16:14:36.746253Z",
  "created_by": "peter@engelbrecht.dk",
  "description": "Update internal/engine/prompt.go to include handoff signals in the agent system prompt:\n\nAdd new section to template:\n```markdown\n## Handoff Signals\n\nWhen you need human involvement, emit a signal and the system will hand off the task:\n\n| Signal | When to Use |\n|--------|-------------|\n| `\u003cpromise\u003eCOMPLETE\u003c/promise\u003e` | Task fully done |\n| `\u003cpromise\u003eAPPROVAL_NEEDED: reason\u003c/promise\u003e` | Work complete, needs human sign-off |\n| `\u003cpromise\u003eINPUT_NEEDED: question\u003c/promise\u003e` | Need human to answer a question |\n| `\u003cpromise\u003eREVIEW_REQUESTED: pr_url\u003c/promise\u003e` | PR created, needs code review |\n| `\u003cpromise\u003eCONTENT_REVIEW: description\u003c/promise\u003e` | UI/copy needs human judgment |\n| `\u003cpromise\u003eESCALATE: issue\u003c/promise\u003e` | Found unexpected issue needing direction |\n| `\u003cpromise\u003eCHECKPOINT: summary\u003c/promise\u003e` | Completed phase, need verification |\n| `\u003cpromise\u003eEJECT: reason\u003c/promise\u003e` | Cannot complete - requires human work |\n\nAfter emitting a handoff signal, the system moves to another task. When a human responds, you may be assigned this task again with their feedback in the notes.\n\n## Reading Human Feedback\n\nIf this task was previously handed off, check the \"Human Feedback\" section for the human's response. Address their feedback before proceeding.\n```\n\nAcceptance criteria:\n- [ ] All 8 signal types documented with usage guidance\n- [ ] Clear format examples provided\n- [ ] Human feedback section documented\n- [ ] Pre-declared gates mentioned",
  "id": "4zs",
  "owner": "peter@engelbrecht.dk",
  "parent": "eso",
  "priority": 1,
  "run": {
    "session_id": "332eba06-1fbf-43a0-baf0-caba56f93951",
    "model": "claude-opus-4-5-20251101",
    "started_at": "2026-01-14T18:41:45.524699+01:00",
    "ended_at": "2026-01-14T18:43:26.114274+01:00",
    "output": "I'll start by reviewing the current task and understanding what needs to be done. Let me first read the prompt.go file to understand the existing template structure.\n\nNow I understand the template structure. I need to:\n\n1. Add a new \"Handoff Signals\" section documenting all 8 signal types\n2. Update the existing \"Human Feedback\" section explanation\n3. Add documentation about \"Reading Human Feedback\"\n\nLet me also check the signals.go file to make sure I reference the correct signal names:\n\nNow I have a complete understanding. I need to update the prompt template to add:\n\n1. A \"Handoff Signals\" section documenting all 8 signals\n2. Update the existing documentation about reading human feedback\n\nLet me now update the prompt.go file. I'll replace the \"Exit signals\" rule (rule 5) with a more comprehensive handoff signals section and add a new section documenting all signal types:\n\nNow let me run the tests to make sure the changes don't break anything:\n\nI see there's a test failing. Let me check the prompt_test.go to see what expectations need to be updated:\n\nI see the test at lines 124-133 is checking for \"Exit signals\" as a section header and specific signal examples. The test expects:\n1. \"Exit signals\" text\n2. `\u003cpromise\u003eEJECT:` example\n3. `\u003cpromise\u003eBLOCKED:` example\n\nMy new section has \"Handoff Signals\" instead of \"Exit signals\", and the format has all 8 signals documented. I need to update the test to match the new comprehensive format.\n\nNow let me also update the test that checks for required sections to include the new \"Handoff Signals\" section:\n\nNow let me run the tests again to verify everything passes:\n\nAll tests pass. Now let me run all tests to make sure nothing else broke:\n\nAll tests pass. Now let me close the task:\n\nTask completed. I've:\n\n1. **Updated `internal/engine/prompt.go`** to add:\n   - A new \"## Handoff Signals\" section with a markdown table documenting all 8 signal types with clear usage guidance\n   - A new \"## Reading Human Feedback\" section explaining how to address human responses\n   - Removed the old \"Exit signals\" bullet from Rules since it's now fully covered in the dedicated section\n\n2. **Updated `internal/engine/prompt_test.go`** to verify:\n   - All 8 handoff signals are documented in the prompt\n   - The \"Reading Human Feedback\" section exists\n   - The required sections list now includes the new sections\n\n3. **All tests pass** (go test ./...)\n\n4. **Closed the task** and added an epic note for future iterations",
    "tools": [
      {
        "name": "Read",
        "duration_ms": 641
      },
      {
        "name": "Read",
        "duration_ms": 463
      },
      {
        "name": "Edit",
        "duration_ms": 9897
      },
      {
        "name": "Bash",
        "duration_ms": 871
      },
      {
        "name": "Read",
        "duration_ms": 852
      },
      {
        "name": "Edit",
        "duration_ms": 4878
      },
      {
        "name": "Edit",
        "duration_ms": 1817
      },
      {
        "name": "Bash",
        "duration_ms": 1373
      },
      {
        "name": "Bash",
        "duration_ms": 895
      },
      {
        "name": "Bash",
        "duration_ms": 3524
      },
      {
        "name": "Bash",
        "duration_ms": 1043
      },
      {
        "name": "Bash",
        "duration_ms": 3446
      },
      {
        "name": "Bash",
        "duration_ms": 3038
      }
    ],
    "metrics": {
      "input_tokens": 2,
      "output_tokens": 3551,
      "cache_read_tokens": 776113,
      "cache_creation_tokens": 32175,
      "cost_usd": 0.70418025,
      "duration_ms": 100093
    },
    "success": true,
    "num_turns": 14
  },
  "status": "closed",
  "title": "Update agent prompt with handoff signals documentation",
  "type": "task",
  "updated_at": "2026-01-14T17:43:06.304088Z"
}